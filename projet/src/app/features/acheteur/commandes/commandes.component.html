<div class="commandes-container">
  <div class="container">
    <div class="page-header">
      <h1><i class="fas fa-shopping-bag"></i> Mes Commandes</h1>
      <span class="total-count" *ngIf="totalDocs > 0">{{ totalDocs }} commande(s)</span>
    </div>

    <!-- Filtres -->
    <div class="filters-bar">
      <div class="filter-group">
        <label>Filtrer par statut:</label>
        <select [(ngModel)]="statutFiltre" (change)="filtrerParStatut()">
          <option *ngFor="let statut of statuts" [value]="statut.value">{{ statut.label }}</option>
        </select>
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="loading">
      <i class="fas fa-spinner fa-spin"></i>
      <p>Chargement des commandes...</p>
    </div>

    <!-- Error Message -->
    <div class="error-message" *ngIf="errorMessage">
      <i class="fas fa-exclamation-circle"></i>
      {{ errorMessage }}
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!loading && commandes.length === 0">
      <i class="fas fa-shopping-bag"></i>
      <h2>Aucune commande</h2>
      <p>Vous n'avez pas encore passé de commande</p>
      <a routerLink="/acheteur/produits" class="btn btn-primary">
        <i class="fas fa-store"></i>
        Découvrir les produits
      </a>
    </div>

    <!-- Commandes List -->
    <div class="commandes-list" *ngIf="!loading && commandes.length > 0">
      <div class="commande-card" *ngFor="let commande of commandes" (click)="voirDetails(commande._id)">
        <div class="commande-header">
          <div class="commande-info">
            <span class="numero">{{ commande.numero_commande }}</span>
            <span class="date">{{ commande.date_commande | date:'dd/MM/yyyy à HH:mm' }}</span>
          </div>
          <div class="commande-statuts">
            <span class="status-badge" [ngClass]="getStatutClass(commande.statut)">
              {{ getStatutLabel(commande.statut) }}
            </span>
            <span class="payment-badge" [ngClass]="getPaiementClass(commande.statut_paiement)">
              {{ getPaiementLabel(commande.statut_paiement) }}
            </span>
          </div>
        </div>

        <div class="commande-body">
          <div class="boutique-info">
            <img [src]="commande.boutique?.logo_url ? 'http://localhost:3000' + commande.boutique.logo_url : 'assets/placeholder-boutique.png'" [alt]="commande.boutique?.nom">
            <span>{{ commande.boutique?.nom }}</span>
          </div>

          <div class="articles-preview">
            <div class="article" *ngFor="let detail of commande.details.slice(0, 3)">
              <img [src]="detail.produit?.images && detail.produit.images[0] ? 'http://localhost:3000' + detail.produit.images[0].url : 'assets/placeholder-product.png'" [alt]="detail.produit?.nom">
            </div>
            <div class="more-articles" *ngIf="commande.details.length > 3">
              +{{ commande.details.length - 3 }}
            </div>
          </div>

          <div class="commande-total">
            <span class="label">Total</span>
            <span class="amount">{{ commande.total | number:'1.2-2' }} €</span>
          </div>
        </div>

        <div class="commande-footer">
          <div class="livraison-info">
            <i class="fas fa-truck"></i>
            <span>{{ commande.adresse_livraison?.ville }}</span>
          </div>
          
          <div class="actions">
            <button class="btn btn-sm btn-secondary" (click)="voirDetails(commande._id); $event.stopPropagation()">
              <i class="fas fa-eye"></i>
              Détails
            </button>
            <button 
              class="btn btn-sm btn-danger" 
              *ngIf="peutAnnuler(commande)"
              (click)="annulerCommande(commande, $event)"
            >
              <i class="fas fa-times"></i>
              Annuler
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination" *ngIf="totalPages > 1">
      <button 
        class="btn btn-secondary" 
        (click)="pagePrecedente()"
        [disabled]="currentPage === 1"
      >
        <i class="fas fa-chevron-left"></i>
        Précédent
      </button>
      <span class="page-info">Page {{ currentPage }} sur {{ totalPages }}</span>
      <button 
        class="btn btn-secondary" 
        (click)="pageSuivante()"
        [disabled]="currentPage === totalPages"
      >
        Suivant
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>
</div>
