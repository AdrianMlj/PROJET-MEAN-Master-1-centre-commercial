<div class="page-container">
  <div class="page-header">
    <div class="header-left">
      <h1>
        <i class="fas fa-plus-circle"></i>
        Créer une catégorie de produits
      </h1>
      <nav class="breadcrumb">
        <a routerLink="/boutique/dashboard">Dashboard</a>
        <i class="fas fa-chevron-right"></i>
        <span>Gestion Produits</span>
        <i class="fas fa-chevron-right"></i>
        <a routerLink="/boutique/produits/categories/liste">Catégories</a>
        <i class="fas fa-chevron-right"></i>
        <span class="current">Créer</span>
      </nav>
    </div>
  </div>

  <div class="content-wrapper">
    <div class="form-card">
      <div class="form-header">
        <div class="form-icon">
          <i class="fas fa-tags"></i>
        </div>
        <div class="form-title">
          <h2>Nouvelle catégorie de produits</h2>
          <p>Ajoutez une catégorie pour organiser vos produits</p>
        </div>
      </div>

      <form [formGroup]="categorieForm" (ngSubmit)="onSubmit()" class="modern-form" novalidate>

        <!-- Messages -->
        <div class="alert alert-success" *ngIf="successMessage">
          <i class="fas fa-check-circle"></i>
          {{ successMessage }}
        </div>
        <div class="alert alert-danger" *ngIf="errorMessage">
          <i class="fas fa-exclamation-circle"></i>
          {{ errorMessage }}
        </div>

        <!-- Nom catégorie -->
        <div class="form-group">
          <label for="nom_categorie">
            <i class="fas fa-tag"></i>
            Nom de la catégorie *
          </label>
          <div class="input-wrapper">
            <input
              type="text"
              id="nom_categorie"
              formControlName="nom_categorie"
              class="form-control"
              placeholder="Ex: T-shirts, Pantalons..."
              [ngClass]="{
                'is-invalid': categorieForm.get('nom_categorie')?.touched && categorieForm.get('nom_categorie')?.invalid,
                'is-valid': categorieForm.get('nom_categorie')?.valid && !isCheckingNom,
                'is-pending': isCheckingNom
              }"
            >
            <span class="input-icon">
              <i class="fas"
                 [class.fa-spinner]="isCheckingNom"
                 [class.fa-spin]="isCheckingNom"
                 [class.fa-check-circle]="categorieForm.get('nom_categorie')?.valid && !isCheckingNom"
                 [class.fa-exclamation-circle]="categorieForm.get('nom_categorie')?.invalid && !isCheckingNom"
                 [class.text-success]="categorieForm.get('nom_categorie')?.valid"
                 [class.text-danger]="categorieForm.get('nom_categorie')?.invalid && !isCheckingNom"
                 [class.text-warning]="isCheckingNom">
              </i>
            </span>
          </div>
          <div class="error-message" *ngIf="getNomCategorieError()">
            {{ getNomCategorieError() }}
          </div>
          <small class="form-text" *ngIf="categorieForm.get('nom_categorie')?.valid && !isCheckingNom && !categorieForm.get('nom_categorie')?.errors?.['nomExiste']">
            <i class="fas fa-check-circle text-success"></i> Nom disponible
          </small>
        </div>

        <!-- Description -->
        <div class="form-group">
          <label for="description">
            <i class="fas fa-align-left"></i>
            Description
          </label>
          <textarea
            id="description"
            formControlName="description"
            class="form-control"
            rows="4"
            placeholder="Description de la catégorie (optionnel)"
          ></textarea>
          <div class="char-counter" *ngIf="categorieForm.get('description')?.value">
            {{ categorieForm.get('description')?.value?.length || 0 }}/500
          </div>
        </div>

        <!-- Image URL -->
        <div class="form-group">
          <label for="image_url">
            <i class="fas fa-image"></i>
            URL de l'image
          </label>
          <input
            type="url"
            id="image_url"
            formControlName="image_url"
            class="form-control"
            placeholder="https://exemple.com/image.jpg (optionnel)"
          >
        </div>

        <!-- Prévisualisation image -->
        <div class="image-preview" *ngIf="categorieForm.get('image_url')?.value">
          <label>Aperçu :</label>
          <div class="preview-container">
            <img [src]="categorieForm.get('image_url')?.value" alt="Aperçu" (error)="onImageError($event)">
            <button type="button" class="remove-image" (click)="categorieForm.patchValue({image_url: ''})">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>

        <!-- Ordre d'affichage -->
        <div class="form-group">
          <label for="ordre_affichage">
            <i class="fas fa-sort-numeric-up"></i>
            Ordre d'affichage
          </label>
          <input
            type="number"
            id="ordre_affichage"
            formControlName="ordre_affichage"
            class="form-control"
            min="0"
            step="1"
          >
          <small class="form-text">Plus le nombre est petit, plus la catégorie apparaît en premier</small>
        </div>

        <!-- Actions -->
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="annuler()" [disabled]="loading">
            <i class="fas fa-times"></i>
            Annuler
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="categorieForm.invalid || loading">
            <i class="fas fa-spinner fa-spin" *ngIf="loading"></i>
            <i class="fas fa-save" *ngIf="!loading"></i>
            {{ loading ? 'Création...' : 'Créer la catégorie' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>