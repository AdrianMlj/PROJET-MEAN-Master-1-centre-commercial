<div class="dashboard-container">
  <!-- En-tête du dashboard -->
  <div class="dashboard-header">
    <div class="header-left">
      <h1>
        <i class="fas fa-tachometer-alt"></i>
        Tableau de Bord Administrateur
      </h1>
      <p class="welcome-message">
        <i class="fas fa-hand-peace"></i>
        Bonjour, <strong>{{ currentUser?.prenom || currentUser?.nom || 'Administrateur' }}</strong>
      </p>
    </div>
    <div class="header-right">
      <div class="date-display">
        <i class="fas fa-calendar-alt"></i>
        {{ currentDate | date:'EEEE d MMMM yyyy' }}
      </div>
      <div class="alert-badge" *ngIf="dashboardData && getAlerteCount() > 0">
        <i class="fas fa-exclamation-circle"></i>
        {{ getAlerteMessage() }}
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="loading">
    <div class="spinner"></div>
    <p>Chargement des données du tableau de bord...</p>
  </div>

  <!-- Error State -->
  <div class="alert alert-danger" *ngIf="errorMessage">
    <i class="fas fa-exclamation-triangle"></i>
    {{ errorMessage }}
  </div>

  <!-- Dashboard Content -->
  <div class="dashboard-content" *ngIf="!loading && dashboardData">

    <!-- Statistiques principales -->
    <div class="stats-grid">
      <!-- Boutiques -->
      <div class="stat-card boutique" (click)="navigateToBoutiques()">
        <div class="stat-icon">
          <i class="fas fa-store"></i>
        </div>
        <div class="stat-content">
          <h3>{{ dashboardData.statistiques.boutiques.total }}</h3>
          <p>Boutiques</p>
          <div class="stat-details">
            <span class="badge success">
              <i class="fas fa-check-circle"></i> {{ dashboardData.statistiques.boutiques.actives }} actives
            </span>
            <span class="badge danger" *ngIf="dashboardData.statistiques.boutiques.inactives > 0">
              <i class="fas fa-times-circle"></i> {{ dashboardData.statistiques.boutiques.inactives }} inactives
            </span>
          </div>
        </div>
      </div>

      <!-- Utilisateurs -->
      <div class="stat-card users" (click)="navigateToUtilisateurs()">
        <div class="stat-icon">
          <i class="fas fa-users"></i>
        </div>
        <div class="stat-content">
          <h3>{{ dashboardData.statistiques.utilisateurs.total }}</h3>
          <p>Utilisateurs</p>
          <div class="stat-details">
            <span class="badge success">
              <i class="fas fa-shopping-cart"></i> {{ dashboardData.statistiques.utilisateurs.acheteurs_actifs }} acheteurs
            </span>
          </div>
        </div>
      </div>

      <!-- Produits -->
      <div class="stat-card products">
        <div class="stat-icon">
          <i class="fas fa-box"></i>
        </div>
        <div class="stat-content">
          <h3>{{ dashboardData.statistiques.produits.total }}</h3>
          <p>Produits</p>
        </div>
      </div>

      <!-- Commandes -->
      <div class="stat-card orders">
        <div class="stat-icon">
          <i class="fas fa-shopping-bag"></i>
        </div>
        <div class="stat-content">
          <h3>{{ dashboardData.statistiques.commandes.total }}</h3>
          <p>Commandes</p>
          <div class="stat-details" *ngIf="dashboardData.statistiques.commandes.ce_mois > 0">
            <span class="badge info">
              <i class="fas fa-calendar"></i> {{ dashboardData.statistiques.commandes.ce_mois }} ce mois
            </span>
          </div>
        </div>
      </div>

      <!-- Chiffre d'affaires -->
      <div class="stat-card revenue">
        <div class="stat-icon">
          <i class="fas fa-chart-line"></i>
        </div>
        <div class="stat-content">
          <h3>{{ formatCurrency(dashboardData.statistiques.chiffre_affaires.total) }}</h3>
          <p>Chiffre d'affaires</p>
          <div class="stat-details">
            <span class="badge info" *ngIf="dashboardData.statistiques.chiffre_affaires.ce_mois > 0">
              <i class="fas fa-calendar"></i> {{ formatCurrency(dashboardData.statistiques.chiffre_affaires.ce_mois) }} ce mois
            </span>
          </div>
        </div>
      </div>

      <!-- Alertes -->
      <div class="stat-card alerts" *ngIf="getAlerteCount() > 0">
        <div class="stat-icon">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="stat-content">
          <h3>{{ getAlerteCount() }}</h3>
          <p>Alertes</p>
          <div class="stat-details">
            <span class="badge warning" *ngIf="dashboardData.alertes.boutiques_inactives > 0">
              {{ dashboardData.alertes.boutiques_inactives }} boutique(s) inactive(s)
            </span>
            <span class="badge warning" *ngIf="dashboardData.alertes.commandes_en_attente > 0">
              {{ dashboardData.alertes.commandes_en_attente }} commande(s) en attente
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Actions rapides -->
    <div class="quick-actions">
      <h2>
        <i class="fas fa-bolt"></i>
        Actions rapides
      </h2>
      <div class="actions-grid">
        <button class="action-btn" (click)="navigateToCreerBoutique()">
          <i class="fas fa-plus-circle"></i>
          <span>Nouvelle boutique</span>
        </button>
        <button class="action-btn" (click)="navigateToCreerUtilisateur()">
          <i class="fas fa-user-plus"></i>
          <span>Nouveau gérant</span>
        </button>
        <button class="action-btn" (click)="navigateToCategories()">
          <i class="fas fa-tags"></i>
          <span>Gérer catégories</span>
        </button>
        <button class="action-btn" (click)="navigateToBoutiques()">
          <i class="fas fa-store"></i>
          <span>Voir boutiques</span>
        </button>
      </div>
    </div>

    <!-- Deux colonnes : Catégories populaires et Dernières activités -->
    <div class="two-columns">
      <!-- Catégories populaires -->
      <div class="column">
        <div class="section-card">
          <h3>
            <i class="fas fa-chart-pie"></i>
            Catégories populaires
          </h3>
          <div class="categories-list" *ngIf="dashboardData.categories_populaires.length > 0">
            <div class="category-item" *ngFor="let cat of dashboardData.categories_populaires">
              <div class="category-info">
                <span class="category-name">{{ cat.categorie }}</span>
                <span class="category-count">{{ cat.nombreBoutiques }} boutique(s)</span>
              </div>
              <div class="category-progress">
                <div class="progress-bar" 
                     [style.width.%]="(cat.nombreBoutiques / dashboardData.statistiques.boutiques.total) * 100">
                </div>
              </div>
            </div>
          </div>
          <div class="empty-message" *ngIf="dashboardData.categories_populaires.length === 0">
            <i class="fas fa-folder-open"></i>
            <p>Aucune catégorie</p>
          </div>
        </div>
      </div>

      <!-- Dernières activités -->
      <div class="column">
        <div class="section-card">
          <h3>
            <i class="fas fa-history"></i>
            Dernières inscriptions
          </h3>
          <div class="activities-list" *ngIf="dashboardData.dernieres_activites.utilisateurs.length > 0">
            <div class="activity-item" *ngFor="let user of dashboardData.dernieres_activites.utilisateurs.slice(0,5)">
              <div class="activity-avatar">
                <i class="fas" [ngClass]="getRoleIcon(user.role.nom_role)"></i>
              </div>
              <div class="activity-info">
                <div class="activity-title">
                  <strong>{{ user.prenom }} {{ user.nom }}</strong>
                  <span class="role-badge" [ngClass]="getRoleBadgeClass(user.role.nom_role)">
                    {{ getRoleLabel(user.role.nom_role) }}
                  </span>
                </div>
                <div class="activity-meta">
                  <span><i class="fas fa-envelope"></i> {{ user.email }}</span>
                  <span><i class="fas fa-calendar"></i> {{ formatDate(user.date_creation) }}</span>
                </div>
              </div>
            </div>
          </div>
          <div class="empty-message" *ngIf="dashboardData.dernieres_activites.utilisateurs.length === 0">
            <i class="fas fa-user-slash"></i>
            <p>Aucun utilisateur</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Dernières boutiques créées -->
    <div class="section-card full-width">
      <h3>
        <i class="fas fa-store-alt"></i>
        Dernières boutiques
      </h3>
      <div class="boutiques-grid" *ngIf="dashboardData.dernieres_activites.boutiques.length > 0">
        <div class="boutique-mini-card" *ngFor="let boutique of dashboardData.dernieres_activites.boutiques">
          <div class="boutique-icon">
            <i class="fas fa-store"></i>
          </div>
          <div class="boutique-info">
            <h4>{{ boutique.nom }}</h4>
            <span class="categorie-tag">{{ boutique.categorie.nom_categorie }}</span>
            <span class="date-tag">
              <i class="fas fa-calendar"></i> {{ formatDate(boutique.date_creation) }}
            </span>
          </div>
        </div>
      </div>
      <div class="empty-message" *ngIf="dashboardData.dernieres_activites.boutiques.length === 0">
        <i class="fas fa-store-slash"></i>
        <p>Aucune boutique</p>
      </div>
    </div>

  </div>
</div>